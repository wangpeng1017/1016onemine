# 智慧矿山技术管理中心 - 技术方案：第二部分 架构设计 (前端Demo)

## 1. 推荐技术栈 (Technology Stack)

根据项目需求（尤其是三维可视化）及当前项目已包含的`React`和`TypeScript`基础，我们推荐以下技术栈来构建一个高性能、可维护的前端Demo。

| 分类 | 技术选型 | 理由 |
| :--- | :--- | :--- |
| **核心框架** | `React 18+` | 业界领先的UI开发库，组件化思想与本项目模块化需求高度契合。现有项目已采用，可以无缝衔接。 |
| **编程语言** | `TypeScript` | 为JavaScript提供静态类型检查，能显著提升代码质量、可读性和可维护性，是大型项目的首选。 |
| **三维渲染引擎** | `Cesium.js` 或 `Three.js` | **Cesium.js**: 专为地理空间数据和三维地球可视化设计，内置GIS功能，非常适合矿山场景的宏观展示和坐标系处理。<br>**Three.js**: 更轻量、灵活的通用3D库，生态丰富。若GIS非强需求，它在自定义渲染和性能调优上更具优势。<br>**选型建议**: **优先推荐Cesium.js**，因为它更贴近矿山地理信息展示的本质需求。 |
| **UI组件库** | `Ant Design (AntD)` | 提供一整套高质量、企业级的React UI组件（如图标、表格、表单、布局等），能极大提升开发效率，保证UI一致性。 |
| **状态管理** | `Zustand` 或 `Redux Toolkit` | **Zustand**: 轻量级、现代的状态管理库，API简洁，上手快，能很好地满足大部分模块的状态共享需求。<br>**Redux Toolkit**: 功能更强大，提供了更严格的数据流管理和更丰富的开发工具，适合处理极其复杂和全局的状态逻辑。<br>**选型建议**: **优先推荐Zustand**，对于Demo开发而言，其轻便性更具优势。 |
| **数据请求** | `axios` | 成熟、稳定、功能丰富的HTTP客户端，支持请求/响应拦截、取消等高级功能，是项目开发的事实标准。 |
| **数据模拟 (Mock)** | `Mock.js` 或 `MSW (Mock Service Worker)` | **Mock.js**: 简单易用，可以快速生成随机数据，拦截`axios`请求并返回模拟数据。<br>**MSW**: 在Service Worker层面拦截请求，对应用代码无侵入，能提供更真实的模拟后端体验。<br>**选型建议**: **优先推荐Mock.js**，对于快速Demo开发，其便捷性更高。 |
| **图表库** | `ECharts for React` | 功能强大，图表类型丰富（KPI、饼图、柱状图、折线图等），能完全满足本项目所有统计分析图表的展示需求。 |
| **构建工具** | `Vite` | 基于ESM的下一代前端构建工具，提供闪电般的冷启动和热更新速度，能极大改善开发体验。 |
| **代码规范** | `ESLint` + `Prettier` | 静态代码检查与格式化工具的黄金组合，能自动统一团队代码风格，规避常见错误。 |

---

## 2. 系统模块化架构设计

为了实现高内聚、低耦合，我们将前端应用划分为清晰的层次和模块。

### 2.1. 前端分层架构

我们将采用经典的前端分层思想，将应用纵向切分为以下几个层次：

```mermaid
graph TD
    subgraph "用户界面层 (UI Layer)"
        P[页面 (Pages)]
        C[组件 (Components)]
    end

    subgraph "业务逻辑层 (Business Logic Layer)"
        S[状态管理 (Stores)]
        H[自定义Hooks (Hooks)]
    end

    subgraph "数据服务层 (Data Service Layer)"
        A[API服务 (APIs)]
        M[数据模拟 (Mocks)]
    end

    subgraph "基础支撑层 (Infrastructure Layer)"
        U[工具库 (Utils)]
        CFG[配置 (Config)]
        T[类型定义 (Types)]
    end

    %% 关系
    P --> H;
    C --> H;
    H --> S;
    H --> A;
    A --> M;

    P --> C;
    S --> A;
    A --> U;
    H --> U;
    
    style P fill:#e6f7ff,stroke:#1890ff
    style C fill:#e6f7ff,stroke:#1890ff
    style S fill:#f6ffed,stroke:#52c41a
    style H fill:#f6ffed,stroke:#52c41a
    style A fill:#fff7e6,stroke:#fa8c16
    style M fill:#fff1f0,stroke:#ff4d4f
    style U fill:#fafafa,stroke:#8c8c8c
    style CFG fill:#fafafa,stroke:#8c8c8c
    style T fill:#fafafa,stroke:#8c8c8c
```

- **用户界面层 (UI Layer)**:
    - `Pages`: 页面级组件，负责组合业务组件，构建完整的用户视图。
    - `Components`: 可复用的UI组件，分为`通用组件`（如按钮、输入框）和`业务组件`（如储量KPI卡片、三维场景视窗）。
- **业务逻辑层 (Business Logic Layer)**:
    - `Stores`: 使用`Zustand`创建的状态存储，用于管理全局或跨组件共享的状态（如用户信息、三维场景对象）。
    - `Hooks`: 自定义的React Hooks，用于封装和复用业务逻辑，如一个`useReservesData` hook，专门负责获取和处理储量数据。
- **数据服务层 (Data Service Layer)**:
    - `APIs`: 封装`axios`请求，定义所有与后端（在此项目中为模拟数据）交互的接口函数。
    - `Mocks`: 使用`Mock.js`定义模拟数据接口和数据模板，为API层提供数据。
- **基础支撑层 (Infrastructure Layer)**:
    - `Utils`: 存放通用的工具函数，如日期格式化、数据转换等。
    - `Config`: 存放项目级配置，如API基地址、三维引擎配置、菜单路由配置等。
    - `Types`: 存放`TypeScript`的类型定义，如API响应体、数据实体的接口定义。

### 2.2. 推荐目录结构

基于上述分层架构，并结合现有项目结构，推荐采用以下目录组织方式：

```
/src
|-- /apis               # API服务层，按模块划分
|   |-- geology.ts
|   |-- reserves.ts
|   `-- ...
|-- /assets             # 静态资源 (图片, 字体等)
|-- /components         # UI组件层
|   |-- /common         # 通用原子组件 (如: <CustomButton />)
|   |-- /business       # 业务组件 (如: <ReservesDashboard />)
|   `-- /layouts        # 布局组件 (如: <MainLayout />)
|-- /config             # 配置层 (路由, 菜单, 全局配置)
|-- /hooks              # 业务逻辑层 (自定义Hooks)
|-- /mocks              # 数据模拟层
|   |-- index.ts        # Mock主入口
|   |-- geology.ts
|   `-- ...
|-- /pages              # 页面层 (路由对应的顶层组件)
|   |-- /GeologyAssurance
|   |   |-- index.tsx
|   |   `-- components
|   `-- ...
|-- /services           # 对接三维引擎、GIS等第三方服务的封装
|   |-- CesiumService.ts
|-- /store              # 状态管理层
|   |-- sceneStore.ts
|   `-- userStore.ts
|-- /types              # TypeScript类型定义
|-- /utils              # 工具库
|-- App.tsx             # 应用主组件
`-- main.tsx            # 应用入口
```
---

## 3. 核心数据结构设计 (TypeScript Interfaces)

由于本项目是纯前端Demo，我们不设计后端数据库。取而代之，我们定义前端应用所需的核心数据实体的TypeScript接口，这将作为我们状态管理和模拟数据的基石。

```typescript
// /src/types/geology.ts

/**
 * @description 钻孔信息
 */
export interface DrillHole {
  id: string;
  name: string; // 孔号
  position: [number, number, number]; // 三维坐标 [x, y, z]
  depth: number; // 深度
}

/**
 * @description 煤层信息
 */
export interface CoalSeam {
  id: string;
  name: string; // 煤层名称
  thickness: number; // 厚度 (m)
  dipAngle: number; // 倾角 (°)
  gangueRate: number; // 含矸率 (%)
  // ... 其他地质参数
}

/**
 * @description 三维地质模型
 */
export interface GeologicalModel {
  id: string;
  name: string; // 模型名称, e.g., "2024年第一季度地质模型"
  version: string; // 版本号
  url: string; // 模型文件路径 (e.g., /models/geology_v1.gltf)
  createdAt: string; // 创建日期 (ISO 8601)
}
```

```typescript
// /src/types/reserves.ts

/**
 * @description 储量分类
 */
export type ReserveCategory = 'geological' | 'industrial' | 'design_recoverable' | 'mined_out';

/**
 * @description 核心储量指标
 */
export interface ReserveKPI {
  geological: number; // 地质储量 (万吨)
  industrial: number; // 工业储量 (万吨)
  design_recoverable: number; // 设计可采储量 (万吨)
  mined_out: number; // 累计采出量 (万吨)
  recovery_rate: number; // 采出率 (%)
}

/**
 * @description 分类储量详情
 */
export interface DetailedReserve {
  id: string;
  name: string; // 如: "开拓煤量", "备采煤量", "控制资源量"
  value: number; // 储量数值 (万吨)
  date: string; // 统计月份 (e.g., "2024-10")
}
```

```typescript
// /src/types/equipment.ts

/**
 * @description 穿爆设备状态
 */
export type EquipmentStatus = 'working' | 'idle' | 'fault';

/**
 * @description 智能穿爆设备
 */
export interface SmartEquipment {
  id: string;
  name: string; // 设备名称, e.g., "智能钻机-001"
  type: 'driller' | 'robot' | 'loader'; // 设备类型
  position: [number, number]; // 二维地图坐标 [lng, lat]
  status: EquipmentStatus;
  realtime_data: {
    depth?: number; // 钻进深度 (m)
    charge?: number; // 装药量 (kg)
    rpm?: number; // 发动机转速 (r/min)
    // ... 其他实时参数
  };
}
```

```typescript
// /src/types/archive.ts

/**
 * @description 资料文件类型
 */
export type ArchiveFileType = 'model' | 'drawing' | 'document';

/**
 * @description 技术资料文件
 */
export interface ArchiveFile {
  id: string;
  name: string; // 文件名
  type: ArchiveFileType;
  path: string; // 文件访问路径
  version: string; // 版本号
  uploadDate: string; // 上传日期
}
```
---

## 4. 模拟API接口设计 (Mock API Endpoints)

我们将遵循RESTful风格设计API接口，并为前端Demo定义清晰的请求/响应格式。所有接口都将通过`Mock.js`进行模拟。

### 4.1. 地质保障模块 (`/api/geology`)

- **GET `/api/geology/models`**: 获取所有地质模型版本。
    - **响应**: `Array<GeologicalModel>`
    ```json
    [
      { "id": "model-01", "name": "2024-Q3地质模型", "version": "v2.1", "url": "/models/model-v2.1.gltf", "createdAt": "2024-09-30T10:00:00Z" },
      { "id": "model-02", "name": "2024-Q2地质模型", "version": "v2.0", "url": "/models/model-v2.0.gltf", "createdAt": "2024-06-30T10:00:00Z" }
    ]
    ```

- **GET `/api/geology/drillholes`**: 获取所有钻孔信息。
    - **响应**: `Array<DrillHole>`
    ```json
    [
      { "id": "dh-001", "name": "ZK01", "position": [120.1, 30.2, -500], "depth": 800 },
      { "id": "dh-002", "name": "ZK02", "position": [120.2, 30.3, -550], "depth": 850 }
    ]
    ```

### 4.2. 储量管理模块 (`/api/reserves`)

- **GET `/api/reserves/kpi`**: 获取核心储量KPI指标。
    - **响应**: `ReserveKPI`
    ```json
    {
      "geological": 12500,
      "industrial": 10000,
      "design_recoverable": 8000,
      "mined_out": 1500,
      "recovery_rate": 18.75
    }
    ```

- **GET `/api/reserves/details`**: 获取分类储量详情。
    - **查询参数**: `?date=2024-10` (查询特定月份) 或 `?type=cumulative` (查询累计)
    - **响应**: `Array<DetailedReserve>`
    ```json
    [
      { "id": "res-01", "name": "开拓煤量", "value": 1200, "date": "2024-10" },
      { "id": "res-02", "name": "备采煤量", "value": 3500, "date": "2024-10" }
    ]
    ```

### 4.3. 智能穿爆模块 (`/api/equipment`)

- **GET `/api/equipment/list`**: 获取所有智能穿爆设备列表及其状态。
    - **响应**: `Array<SmartEquipment>`
    ```json
    [
      { "id": "drill-001", "name": "智能钻机-001", "type": "driller", "position": [120.15, 30.25], "status": "working", "realtime_data": { "depth": 50.5, "rpm": 120 } },
      { "id": "load-001", "name": "智能装药车-001", "type": "loader", "position": [120.16, 30.26], "status": "idle", "realtime_data": { "charge": 500 } }
    ]
    ```
    *（注：在Demo中，可以通过定时器和`Mock.js`来模拟设备位置和实时数据的动态变化。）*

### 4.4. 技术资料模块 (`/api/archive`)

- **GET `/api/archive/files`**: 根据分类获取文件列表。
    - **查询参数**: `?type=model` (可为 `model`, `drawing`, `document`)
    - **响应**: `Array<ArchiveFile>`
    ```json
    [
        { "id": "file-01", "name": "2024年度采掘设计图.dwg", "type": "drawing", "path": "/files/drawing-2024.dwg", "version": "v1.2", "uploadDate": "2024-03-15T09:00:00Z" },
        { "id": "file-02", "name": "采场环评报告.pdf", "type": "document", "path": "/files/report-env.pdf", "version": "v1.0", "uploadDate": "2024-02-20T14:30:00Z" }
    ]