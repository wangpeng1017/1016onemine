好的，遵照您的指示。我将我们对话中的所有上下文，包括产品级的宏观规划（PRD）和项目级的具体实施细节（SRS），进行了一次全面、深度、无删减的融合。

最终形成这份 **“终极版”** 的综合性需求规格说明书。这份文档既包含了产品的战略高度，也深入到了代码实现的具体细节，旨在成为项目从启动到交付全过程中的唯一、权威的指导性文件。

---

### **新疆露天矿山边坡安全综合监测系统**
### **产品与项目需求规格说明书 (终极融合版)**

**版本: 5.0 (终极版)**
**日期: 2025年9月9日**
**文档状态**: 正式发布

---

### **1. 产品概述 (Product Overview)**

#### **1.1 产品定义**
新疆露天矿山边坡安全综合监测系统是一个基于物联网(IoT)、三维地理信息系统(GIS)和大数据分析技术的综合性安全监控与决策支持平台。本系统严格遵循《新疆露天矿山边坡安全监测数据接入规范》作为核心数据标准，通过集成多种在线监测传感器设备（如GNSS、边坡雷达、裂缝计、雨量计等）和空天遥感数据，为新疆区域内的露天矿山边坡安全生产提供全面的数据支撑、风险预警和科学决策服务。

#### **1.2 产品愿景**
构建智能化、数字化的矿山安全监测体系，实现对矿山边坡从宏观（卫星遥感）到微观（传感器监测）的全方位、全天候、全过程风险感知。通过精准的数据分析与及时的风险预警，科学管控安全风险，变被动的事故响应为主动的风险预防，最终保障矿山作业人员的生命安全和企业的财产安全。

#### **1.3 目标用户**
*   **主要用户**：矿山安全管理人员、监测技术人员（地质、测量）、现场作业人员。
*   **次要用户**：矿山企业管理层、政府应急管理与监管部门、第三方安全技术服务机构。

#### **1.4 核心价值**
*   **实时全面监测**: 实时监测矿山边坡安全状态，融合多源数据，及时发现安全隐患。
*   **科学预警决策**: 提供基于规范和模型的科学数据分析与预警机制，提升安全管理的决策水平。
*   **提升管理效率**: 提升矿山安全管理效率，降低人工巡检成本与风险。
*   **降低事故风险**: 显著降低因边坡失稳等灾害导致的安全事故发生概率。

---

### **2. 产品功能需求 (Functional Requirements)**

#### **2.1 功能架构图**
```
新疆露天矿山边坡安全综合监测系统
├── 综合态势一张图 (GIS驾驶舱)
├── 监测数据中心
│   ├── 表面位移监测 (GNSS)
│   ├── 裂缝计监测
│   ├── 土压力监测
│   ├── 地下水监测
│   ├── 爆破振动监测
│   ├── 雨量计监测
│   └── 雷达监测
├── 空天风险监测 (核心GIS分析模块)
│   ├── 边坡卫星形变风险
│   ├── 超层越界风险
│   └── 边坡形态超限风险
├── 地理空间图层管理
├── 基础信息管理
│   ├── 边坡基础信息
│   └── 采场台阶基础信息
├── 设备管理
├── 告警中心
│   ├── 实时告警
│   └── 历史告警查询
├── 数据上报监控
├── 报告与文档中心
├── 系统管理
│   ├── 阈值设置
│   ├── 账号与权限管理
│   └── 系统配置
```

#### **2.2 详细功能需求**

##### **2.2.1 综合态势一张图 (GIS驾驶舱)**
*   **用户故事**: 作为一名矿山安全管理者，我希望一登录系统就能在首页看到整个矿区的安全“体检报告”，三维模型上要直接告诉我哪里最危险，关键数据一目了然，有新告警能立刻知道。
*   **功能描述**:
    此模块是系统的门户和指挥中心，以一个可交互的三维GIS视窗为核心，聚合展示矿区最核心的安全状态信息。
*   **可视化与交互要求**:
    1.  **核心三维GIS视窗**:
        *   页面加载后，默认加载最新的矿区三维实景模型（`.3dtiles`）或高精度卫星影像底图（DOM）。
        *   默认在三维模型上，自动加载并高亮渲染“空天风险监测”模块中的**红色（1级）**和**橙色（2级）**风险区域，让高危区域一目了然。
    2.  **关键数据看板 (Dashboard Widgets)**:
        *   在GIS视窗的顶部或两侧，以醒目的数据卡片形式展示以下实时统计信息：
            *   **活动告警统计**: 按“红、橙、黄、蓝”四级分类，分别显示当前未处理的告警数量。
            *   **最大形变速率监测点**: 显示当前形变速率最快的监测点编号及其速率值（例如：`GNSS-078: 5.2 mm/h`）。
            *   **超限风险点总数**: 统计“边坡形态超限风险”中，当前实际值超过设计值的监测点总数。
            *   **在线设备率**: 显示当前在线的监测设备总数与总设备数的百分比。
    3.  **实时告警滚动列表**:
        *   在页面一侧，以列表形式实时滚动展示最新的5-10条告警信息。
        *   每条信息需包含：告警级别（用颜色区分）、告警时间、告警设备/区域、告警内容摘要。
        *   列表中的每一条告警都必须是可点击的，点击后直接跳转至“告警中心”的该条告警详情页面。
    4.  **快速导航入口**:
        *   提供一组图标按钮，用于快速访问最常用的功能，如：“图层管理”、“最新监测报告”、“应急预案”等。

##### **2.2.2 监测数据中心**
*   **用户故事**: 作为一名监测技术员，我需要一个地方能深入研究所有传感器的原始数据，不仅要看实时值，还要能对比历史数据、看变化趋势图，并且能方便地把数据导出去做进一步分析。
*   **功能描述**:
    此模块是所有传感器原始数据的汇集地，为专业技术人员提供详细的数据查询、可视化分析和导出功能。每个子模块都应包含**GIS点位分布**、**实时数据列表**、**历史趋势图表**三大核心视图。
*   **通用要求**: 每个监测子模块（如GNSS、裂缝计等）均需提供：
    1.  **GIS点位分布视图**: 在2D/3D地图上展示该类型所有监测点的分布，点的颜色根据其当前最新状态（正常/预警/告警）动态变化。点击点位可查看其基本信息和最新数据。
    2.  **实时数据列表视图**: 以表格形式展示所有监测点的最新数据。表格需支持按任意字段排序和多条件组合筛选。
    3.  **历史趋势图表视图**: 用户选择一个或多个监测点后，系统生成多轴线图，展示其在选定时间范围内的关键指标随时间的变化曲线。图表需支持缩放、平移、数据点悬浮提示(Tooltip)等交互。
    4.  **数据导出功能**: 提供将当前查询结果导出为CSV或Excel格式的功能。

*   **各监测子模块详细规格**:
    *   **表面位移监测 (GNSS)**:
        *   **数据列表字段**: 点编号、位置、X/Y/Z轴累计位移量、小时位移速度、小时位移加速度、设备状态、电池电量、更新时间。
        *   **历史图表**: 可同时绘制累计位移、速率、加速度三条曲线。
    *   **裂缝计监测**:
        *   **数据列表字段**: 设备编号、安装位置、裂缝宽度/位移量、环境温度、设备状态、监测状态。
        *   **历史图表**: 支持将裂缝位移量与环境温度的曲线叠加显示，以供进行温度补偿分析。
    *   **土压力监测**:
        *   **数据列表字段**: 设备编号、监测深度、压力值、环境温湿度、设备倾斜角。
        *   **可视化**: 除标准图表外，需支持生成沿深度剖面的压力分布图。
    *   **地下水监测**:
        *   **数据列表字段**: 设备编号、水位、水压、pH值、电导率、浊度、水温。
        *   **历史图表**: 支持将多个水文水质参数在同一图表中进行对比展示。
    *   **爆破振动监测**:
        *   **数据列表字段**: 事件ID、爆破时间、峰值速度、主振频率、持续时间、X/Y/Z轴振动速度、振动等级评定。
    *   **雨量计监测**:
        *   **数据列表字段**: 设备编号、小时/日/月降雨量、累计降雨量、降雨强度。
        *   **可视化**: 提供降雨量柱状图和累计降雨量曲线图。
    *   **雷达监测**:
        *   **数据列表字段**: 监测区域、位移量、速度、加速度、信号质量。
        *   **可视化**: 在三维模型上以彩色热力图形式渲染大范围的位移形变场。

##### **2.2.3 空天风险监测**
*   **用户故事**: 作为地质工程师，我需要一个强大的GIS工具，能把《新疆数据规范》里定义的那些风险数据（比如卫星发现的沉降区、无人机发现的超高台阶）直观地画在三维地图上，让我能圈出风险范围，分析风险点位的具体数值。
*   **功能描述**:
    此模块是系统的核心GIS分析模块，严格遵循《新疆数据规范》，将上传的各类风险分析结果进行专业、精确的可视化呈现。
*   **边坡卫星形变风险**:
    *   **数据源**: 严格解析 `露天矿山编号_deformationrisk_*.json` 文件。
    *   **可视化要求**:
        1.  解析`risk_boundary`字段的WKT字符串，在GIS视窗中将其渲染为多边形区域。
        2.  根据`risk_level`字段的值，对该多边形进行颜色填充：**1=红色, 2=橙色, 3=黄色, 4=蓝色**。
        3.  解析`risk_values`数组，将其中每一个风险监测点以散点的形式叠加在地图上，点的颜色或大小应与其`value`（形变值）成正比，形成形变热力图效果。
        4.  鼠标悬浮在风险区域或点上时，弹出信息框，显示风险级别、形变值、坐标等详细信息。
*   **超层越界风险**:
    *   **数据源**: 严格解析 `..._overstephorizontalrisk_*.json` (越界) 和 `..._overstepverticalrisk_*.json` (超层) 文件。
    *   **可视化要求**:
        1.  解析`overborder_bry`字段的WKT字符串，在GIS地图上渲染出越界开采的范围边界线（建议使用醒目的虚线）。
        2.  解析`over_layer_points`数组，将每一个超层开采点以特殊的警告图标（如红色感叹号三角形）在地图上进行标注。
        3.  点击越界范围或超层点，弹出信息框，清晰展示越界面积(`croborder_acr`)、超层点的超限值(`value`)及高程等详细信息。
*   **边坡形态超限风险**:
    *   **数据源**: 严格解析 `露天矿山编号_overmorphologyrisk_*.json` 文件。
    *   **可视化要求**:
        1.  解析`risk_range`字段的WKT字符串，在GIS地图上渲染出存在形态风险的台阶范围。
        2.  根据`risk_level`字段的值，对该区域进行四色渲染。
        3.  解析`risk_values`数组，将所有监测点进行标注。如果点的`value`（实际值）超过了`design_value`（设计值），该点必须高亮显示（如闪烁或放大图标）。
        4.  点击监测点，弹出信息框，并排对比展示“设计值”与“实际值”，让超限情况一目了然。

##### **2.2.4 地理空间图层管理**
*   **数据源**: `..._layerinfo_*.json` 及关联的FTP文件。
*   **UI/UX要求**: 提供一个可收起的、悬浮的图层控制面板。面板内使用带复选框的树状列表来组织所有图层，并提供图层透明度调节滑块。

##### **2.2.5 基础信息管理**
*   **数据源**: `..._slopeinfo_*.json`, `..._stepinfo_*.json`。
*   **UI/UX与交互要求**: 采用两栏布局，左侧为可搜索的边坡列表，右侧为选中边坡的详细信息及其下的台阶列表。**必须实现GIS联动**：点击列表中的任何边坡或台阶，三维GIS视窗必须平滑地飞行定位至该元素，并高亮其边界。

##### **2.2.6 设备管理**
*   **UI/UX要求**: 标准的CRUD管理页面。列表页需清晰展示设备核心状态（类型、状态、电量、最后通信时间）。详情页需展示设备所有档案信息、维护历史和故障记录。

##### **2.2.7 告警中心**
*   **UI/UX要求**: 列表页需使用颜色和图标明确区分告警级别，并提供强大的筛选功能。告警详情页必须包含：
    1.  完整的告警信息。
    2.  一个内嵌的GIS视图，自动定位到告警源。
    3.  一个快速链接，点击可跳转到该告警源（如某个GNSS点）的“监测数据中心”历史图表页面，方便追溯。
    4.  告警处理流程跟踪模块（确认、处理中、已关闭）。

##### **2.2.8 数据上报监控**
*   **UI/UX要求**: 以仪表盘和列表形式展示设备在线率、上报成功率等宏观指标。提供详细的上报历史查询功能，能追溯每一次上报的具体内容和状态。

##### **2.2.9 报告与文档中心**
*   **UI/UX要求**: 一个简洁的文件管理器界面，提供列表视图。对于PDF文件，必须支持在浏览器新标签页中直接打开预览，而不是强制下载。

##### **2.2.10 系统管理**
*   **阈值设置**: 界面需按设备类型使用页签(Tabs)进行组织。对于雷达和GNSS，必须提供“红、橙、黄、蓝”四级阈值的输入框。
*   **账号管理**: 标准的用户和角色管理界面，权限分配需采用清晰的复选框树状结构。

---

### **3. 非功能性需求 (Non-Functional Requirements)**

#### **3.1 性能需求**
*   **响应时间**: 页面加载时间 < 3秒，数据查询响应时间 < 2秒，实时数据更新延迟 < 5秒。
*   **并发性能**: 支持100个并发用户同时在线，支持1000个设备同时数据上报，数据库查询QPS > 500。
*   **数据处理能力**: 单日数据处理量 > 1000万条，数据存储容量 > 10TB，历史数据保存期限 ≥ 5年。

#### **3.2 可用性需求**
*   **系统可用性**: 系统可用性 ≥ 99.5%，计划内停机时间 < 4小时/月，故障恢复时间 < 30分钟。
*   **容错能力**: 支持设备离线缓存机制，数据传输失败自动重试，系统异常自动告警。

#### **3.3 安全性需求**
*   **数据安全**: 数据传输加密（HTTPS/TLS），数据存储加密，定期数据备份。
*   **访问控制**: 用户身份认证，基于角色的权限控制，操作日志审计。
*   **系统安全**: 防SQL注入攻击，防XSS攻击，防CSRF攻击。

#### **3.4 兼容性需求**
*   **浏览器兼容性**: Chrome ≥ 88, Firefox ≥ 85, Safari ≥ 14, Edge ≥ 88。
*   **设备兼容性**: 桌面端（Windows、macOS、Linux），移动端（iOS、Android），平板设备支持。

#### **3.5 可扩展性需求**
*   **水平扩展**: 支持负载均衡部署，支持微服务架构，支持容器化部署。
*   **功能扩展**: 支持新设备类型接入，支持第三方系统集成，支持API接口扩展。

---

### **4. 技术架构**

#### **4.1 前端技术栈**
*   **核心框架**: React 18 + TypeScript
*   **UI组件库**: Ant Design 5.x
*   **路由管理**: React Router 6
*   **三维GIS引擎**: CesiumJS
*   **数据可视化**: ECharts
*   **开发工具**: Create React App, ESLint + Prettier, Jest + Testing Library

#### **4.2 后端技术栈 (建议)**
*   **服务端框架**: Java Spring Boot
*   **通信协议**: RESTful API, WebSocket
*   **数据库**: PostgreSQL + PostGIS, InfluxDB, Redis
*   **消息队列**: RabbitMQ / Apache Kafka

#### **4.3 部署架构**
*   **容器化**: Docker
*   **集群管理**: Kubernetes
*   **云服务**: AWS / 阿里云 / 腾讯云
*   **CI/CD**: Jenkins / GitLab CI

---

### **5. 数据模型**

#### **5.1 核心数据实体**
*   **设备信息表 (devices)**
*   **监测数据表 (monitoring_data)**
*   **告警记录表 (alarms)**
*   **用户信息表 (users)**

#### **5.2 数据流设计**
设备传感器 → 数据采集网关 → 消息队列 → 数据处理服务 → 数据库存储 → 告警引擎 → 告警通知服务 → 前端实时更新

---

### **6. 用户界面设计**

#### **6.1 设计原则**: 易用性、一致性、响应式设计。
#### **6.2 界面布局**: 顶部导航栏 + 左侧菜单 + 主内容区域 + 底部信息栏。
#### **6.3 色彩方案**: 主色调蓝色系，辅助色绿、黄、红，背景色浅灰、白。

---

### **7. 测试需求**

#### **7.1 功能测试**: 单元测试（覆盖率 ≥ 80%）、集成测试、系统测试、用户验收测试。
#### **7.2 性能测试**: 负载测试、压力测试、容量测试、稳定性测试。
#### **7.3 安全测试**: 身份认证和授权测试、数据加密和传输安全测试、SQL注入和XSS攻击测试、系统漏洞扫描。
#### **7.4 兼容性测试**: 多操作系统、多浏览器、多设备测试。

---

### **8. 部署和运维**

#### **8.1 部署环境**: 开发、测试、生产环境隔离。
#### **8.2 监控和运维**: 服务器、应用、数据库、网络的全链路监控。
#### **8.3 日志管理**: 应用日志收集、错误日志分析、操作日志审计。
#### **8.4 备份策略**: 数据库定期备份、配置文件备份、代码版本备份、灾难恢复预案。

---

### **9. 项目计划**

#### **9.1 开发阶段**
*   **第一阶段（1-2个月）**: 系统架构设计，核心功能开发。
*   **第二阶段（2-3个月）**: 监测数据模块、设备管理、告警系统开发。
*   **第三阶段（1-2个月）**: 数据可视化、用户管理、系统集成测试。
*   **第四阶段（1个月）**: 性能优化，安全加固，部署上线。

#### **9.2 里程碑节点**: M1(架构确定) → M2(主要功能完成) → M3(系统测试完成) → M4(正式上线)。

---

### **10. 风险评估**

#### **10.1 技术风险**: 数据实时性、系统性能、安全风险。
#### **10.2 业务风险**: 需求变更、用户接受度。
#### **10.3 项目风险**: 进度风险、资源风险。

---

### **11. 成功标准**

#### **11.1 功能完整性**: 所有需求功能100%实现，测试通过率≥95%。
#### **11.2 性能指标**: 系统响应时间、并发用户数、可用性达标。
#### **11.3 用户满意度**: 用户培训完成率≥90%，满意度评分≥4.0/5.0。
#### **11.4 商业价值**: 提升安全管理效率≥30%，减少安全事故发生率≥50%。

---

### **12. 附录**

#### **A. 术语表**: GNSS, IoT, API, QPS, SLA, GIS, WKT。
#### **B. 参考文档**:
*   《新疆露天矿山边坡安全监测数据接入规范》
*   矿山安全生产法规
*   系统架构设计规范
*   用户界面设计指南